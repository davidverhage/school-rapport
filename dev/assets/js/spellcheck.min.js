/** Javascript/PHP Spell Checker v1.6 https://github.com/LPology/Javascript-PHP-Spell-Checker Copyright 2012-2015 LPology, LLC Released under the MIT license */
(function(h,l,b){var k=h.sc||{},p=/^\s+/,n=/\s+$/,e=/[^\s]+/,i=/[^\s]+$/,d=/[xy]/g,g=/&/g,m=/"/g,q=/'/g,c=/</g,a=/>/g,j=/^\w+$/,f={},o=function(r){return l.getElementById(r)};k.objectKeys=function(s){var r=[];for(var t in s){if(s.hasOwnProperty(t)){r.push(t)}}return r};k.obj2string=function(u,t){var w=[];for(var x in u){if(u.hasOwnProperty(x)){var s=t?t+"["+x+"]":x,r=u[x];w.push(typeof r==="object"?k.obj2string(r,s):encodeURIComponent(s)+"="+encodeURIComponent(r))}}return w.join("&")};k.extendObj=function(s,r){for(var t in r){if(r.hasOwnProperty(t)){s[t]=r[t]}}};k.isEmpty=function(r){for(var s in r){if(r.hasOwnProperty(s)){return false}}return true};k.contains=function(t,s){var r=t.length;while(r--){if(t[r]===s){return true}}return false};k.purge=function(u){var s=u.attributes,t,r,v;if(s){for(t=s.length-1;t>=0;t-=1){v=s[t].name;if(typeof u[v]==="function"){u[v]=null}}}s=u.childNodes;if(s){r=s.length;for(t=0;t<r;t+=1){k.purge(u.childNodes[t])}}};k.remove=function(r){if(r&&r.parentNode){k.purge(r);r.parentNode.removeChild(r)}r=null};k.trim=function(r){return r.toString().replace(p,"").replace(n,"")};k.getId=function(){return"axxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(d,function(u){var t=Math.random()*16|0,s=u=="x"?t:(t&3|8);return s.toString(16)})};k.addEvent=function(t,s,r){if(typeof t==="string"){t=l.getElementById(t)}if(t.addEventListener){t.addEventListener(s,r,false)}else{t.attachEvent("on"+s,r)}return function(){k.removeEvent(t,s,r)}};k.removeEvent=function(t,s,r){if(typeof t==="string"){t=l.getElementById(t)}if(t.removeEventListener){t.removeEventListener(s,r,false)}else{t.detachEvent("on"+s,r)}};k.newXHR=function(){if(typeof XMLHttpRequest!=="undefined"){return new h.XMLHttpRequest()}else{if(h.ActiveXObject){try{return new h.ActiveXObject("Microsoft.XMLHTTP")}catch(r){return false}}}};k.encodeHTML=function(r){return String(r).replace(g,"&amp;").replace(m,"&quot;").replace(q,"&#39;").replace(c,"&lt;").replace(a,"&gt;")};k.parseJSON=function(s){if(!s){return false}s=k.trim(s+"");if(h.JSON&&h.JSON.parse){try{return h.JSON.parse(s+"")}catch(r){return false}}var t=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,u=null,v;return s&&!k.trim(s.replace(t,function(y,w,x,z){if(v&&w){u=0}if(u===0){return y}v=x||w;u+=!z-!x;return""}))?(Function("return "+s))():false};k.verifyElem=function(r){if(typeof jQuery!=="undefined"&&r instanceof jQuery){r=r[0]}else{if(typeof r==="string"){if(r.charAt(0)=="#"){r=r.substr(1)}r=l.getElementById(r)}}if(!r||r.nodeType!==1){return false}if(r.nodeName.toUpperCase()=="A"){r.style.cursor="pointer";k.addEvent(r,"click",function(s){if(s&&s.preventDefault){s.preventDefault()}else{if(h.event){h.event.returnValue=false}}})}return r};k.SpellChecker=function(s){var r=this;this._settings={action:"",button:"",textInput:"",name:"text",data:{},debug:false,onOpen:function(t,u){},onClose:function(t,u){}};k.extendObj(this._settings,s);this._button=k.verifyElem(this._settings.button);this._textInput=k.verifyElem(this._settings.textInput);delete this._settings.button;if(this._button===false){throw new Error("Invalid button. Make sure the element you're passing exists.")}if(this._textInput===false){throw new Error("Invalid text field. Make sure the element you're passing exists.")}this._closeOnEsc=function(t){if(t.keyCode===27){r._closeChecker()}};this._uId=k.getId();this._createHTML();this._currentBox=o("spell-current"+this._uId);this._contextBox=o("spell-context"+this._uId);this._undoBtn=o("spell-undo"+this._uId);this._select=o("spelling-suggestions"+this._uId);this._isOpen=false;this._button.className+=" spellcheck-trigger";this.enable()};k.SpellChecker.prototype={enable:function(){var r=this;this._button.off=k.addEvent(this._button,"click",function(){r._openChecker()});k.addEvent("spelling-ignore"+this._uId,"click",function(){r._ignore()});k.addEvent("spelling-ignore-all"+this._uId,"click",function(){r._ignore(true)});k.addEvent("spell-change"+this._uId,"click",function(){r._makeChange()});k.addEvent("spell-change-all"+this._uId,"click",function(){r._makeChange(true)});k.addEvent("spell-close"+this._uId,"click",function(){r._closeChecker()});k.addEvent("spell-msg-close"+this._uId,"click",function(){r._closeChecker()});k.addEvent(this._undoBtn,"click",function(){r._undoChange()});k.addEvent(this._currentBox,"click",function(){o("spelling-suggestions"+r._uId).selectedIndex=-1});k.addEvent(this._contextBox,"click",function(){o("spelling-suggestions"+r._uId).selectedIndex=-1});k.addEvent(this._currentBox,"keyup",function(){var s=this._contextBox.getElementsByTagName("span")[0];if(s&&s.firstChild){s.firstChild.nodeValue=this.value}});k.addEvent(this._contextBox,"keyup",function(){var s=this.getElementsByTagName("span")[0];if(s&&s.firstChild){this._currentBox.value=s.firstChild.nodeValue}})},destroy:function(){if(this._isOpen){this._closeChecker()}if(this._button.off){this._button.off()}this._button.className=this._button.className.replace(/(?:^|\s)spellcheck-trigger(?!\S)/,"");k.remove(this._msgBox);k.remove(this._modal);k.remove(this._overlay);for(var r in this){if(this.hasOwnProperty(r)){delete this.prop}}},log:function(r){if(this._settings.debug&&h.console){console.log("[spell checker] "+r)}},_getRegex:function(r){if(!f[r]){f[r]=new RegExp(r,"g")}return f[r]},_openChecker:function(){if(this._isOpen){return}this._undoBtn.disabled=true;this._overlay.style.display="block";this._modal.style.display="block";this._text=this._textInput.value;this._isOpen=true;this._undo=[];k.addEvent(l,"keyup",this._closeOnEsc);this._notifyMsg("a");this._sendData()},_closeChecker:function(){if(!this._isOpen){return}this._msgBox.style.display="none";this._modal.style.cssText="display:none; z-index:4999;";this._overlay.style.display="none";this._currentBox.value="";this._contextBox.innerHTML="";this._select.options.length=0;this._undo.length=0;this._text=this._wordObject=this._wordKeys=this._currentWord=this._wordMatches=this._matchOffset=this._undo=this._isOpen=null;k.removeEvent(l,"keyup",this._closeOnEsc);this._settings.onClose.call(this,this._button,this._textInput.value)},_notifyMsg:function(r){var t,s=o("spell-msg-close-box"+this._uId);if(r=="a"){t="Checking...";s.style.display="none"}else{s.style.display="block"}if(r=="b"){t="We experienced an error and were unable to complete the spell check."}if(r=="c"){t="Spell check completed. No errors found."}if(r=="d"){t="Spell check completed."}this._modal.style.zIndex=4999;o("spell-msg-text"+this._uId).innerHTML=t;this._msgBox.style.display="block";if(r!="a"){o("spell-msg-close"+this._uId).focus()}},_ignore:function(s){var r;if(s===true||this._wordMatches<=1||this._matchOffset===this._wordMatches){this._wordKeys.splice(0,1);this._matchOffset=1;r=false}else{this._matchOffset++;r=true}this._undoBtn.disabled=true;this._undo.length=0;if(this._wordKeys.length>0||r===true){this._reviewWord()}else{this._notifyMsg("d")}},_makeChange:function(u){var w=this,x=this._getRegex(this._currentWord),y=this._select.selectedIndex,s=0,t,v,r;this._undo.unshift({text:this._text,word:this._currentWord,numMatches:this._wordMatches,matchOffset:this._matchOffset});this._undoBtn.disabled=false;if(y>-1){t=this._select.options[y].text}else{t=this._currentBox.value}v=this._text.replace(x,function(z){s++;if(u===true||w._matchOffset===s){return t}return z});if(u===true||w._wordMatches<=1||w._matchOffset===w._wordMatches){this._wordKeys.splice(0,1);this._matchOffset=1;r=false}else{r=true}this._textInput.value=this._text=v;if(this._wordKeys.length>0||r===true){this._reviewWord()}else{this._notifyMsg("d")}},_undoChange:function(){var r=this._undo[0];this._textInput.value=this._text=r.text;this._currentBox.value=r.word;if(!k.contains(this._wordKeys,r.word)){this._wordKeys.unshift(r.word)}this._currentWord=r.word;this._wordMatches=r.numMatches;this._matchOffset=r.matchOffset;this._setSuggestionOptions();this._setContextBox();this._undo.splice(0,1);if(this._undo.length<1){this._undoBtn.disabled=true}},_setSuggestionOptions:function(){var r=this._wordObject[this._currentWord],s=r.length,t;this._select.options.length=0;for(t=0;t<s;t++){this._select.options[t]=new Option(r[t],r[t])}this._select.selectedIndex=0},_setContextBox:function(){var s=this,r=this._currentWord.length,v=this._getRegex(this._currentWord),u=this._text.length,t=0;this._text.replace(v,function(y,x){if(j.test(s._text.substr(x+r,1))){return y}t++;if(t===s._matchOffset){var B,z,w=x-20,A=x+r;if(w<0){B=s._text.substr(0,x)}else{B=s._text.substr(w,20)}if(A+50>u){z=s._text.substr(A)}else{z=s._text.substr(A,50)}B=B.replace(p,"").replace(e,"").replace(p,"");z=z.replace(n,"").replace(i,"").replace(n,"");s._contextBox.innerHTML=k.encodeHTML(B)+'<span class="word-highlight">'+k.encodeHTML(s._currentWord)+"</span>"+k.encodeHTML(z)}return y})},_reviewWord:function(){this._currentWord=this._wordKeys[0];this._currentBox.value=this._currentWord;this._wordMatches=this._getTotalWordMatches();this._setSuggestionOptions();this._setContextBox()},_getTotalWordMatches:function(){var s=this._getRegex(this._currentWord),r=this._currentWord.length,t=0,u=this._text;this._text.replace(s,function(w,v){if(!j.test(u.substr(v+r,1))){t++}return w});return t},_begin:function(r){if(r.success&&r.success===true){if(r.errors&&r.errors===true){this._wordObject=r.words;this._wordKeys=k.objectKeys(this._wordObject);this._matchOffset=1;this._msgBox.style.display="none";this._modal.style.zIndex=5001;this._reviewWord()}else{this._notifyMsg("c")}}},_sendData:function(){var r=this,t=k.newXHR(),s,u;if(this._text.length<2){this._notifyMsg("c");return}s=encodeURIComponent(this._settings.name)+"=";s+=encodeURIComponent(this._text);if(!k.isEmpty(this._settings.data)){s+="&";s+=k.obj2string(this._settings.data)}u=function(){var w,v,y;try{if(u&&t.readyState===4){u=b;t.onreadystatechange=function(){};if(!r._isOpen){return}v=t.status;try{y=t.statusText}catch(x){y=""}r.log("Request completed. Status: "+v+" "+y);if(v>=200&&v<300){w=k.parseJSON(t.responseText);if(w!==false){r._settings.onOpen.call(r,r._button,r._text);r._begin(w)}else{r.log("Error parsing server response");r._notifyMsg("b")}t=w=null}else{r._notifyMsg("b")}}}catch(x){r.log("Error: "+x.message);r._notifyMsg("b")}};t.onreadystatechange=u;t.open("POST",this._settings.action,true);t.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");t.setRequestHeader("X-Requested-With","XMLHttpRequest");t.setRequestHeader("Content-Type","application/x-www-form-urlencoded");r.log("Sending data...");t.send(s)},_createHTML:function(){this._overlay=l.createElement("div");this._modal=l.createElement("div");this._msgBox=l.createElement("div");this._overlay.className="spell-check-overlay";l.body.appendChild(this._overlay);this._modal.className="spell-wrap";this._modal.innerHTML='<div class="spell-header"><div>Spell Check</div></div><div id="spelling-inner'+this._uId+'" class="spelling-inner"><div class="clearleft">Not found in dictionary:</div><div class="spell-nf"><input type="text" class="current" id="spell-current'+this._uId+'" /><div class="context" contenteditable="true" id="spell-context'+this._uId+'"></div></div><div class="spell-ignorebtns"><button id="spelling-ignore'+this._uId+'" type="button">Ignore</button><button id="spelling-ignore-all'+this._uId+'" type="button">Ignore All</button></div><div class="clearleft">Suggestions:</div><div class="spell-suggest"><select size="8" id="spelling-suggestions'+this._uId+'"><option></option></select></div><div class="spell-changebtns"><button type="button" id="spell-change'+this._uId+'">Change</button><button id="spell-change-all'+this._uId+'">Change All</button><button type="button" id="spell-undo'+this._uId+'">Undo</button></div><hr /><div class="close-box"><button type="button" id="spell-close'+this._uId+'">Close</button></div></div>';l.body.appendChild(this._modal);this._msgBox.className="spell-msg";this._msgBox.innerHTML='<div class="spell-header"><div>Spell Check</div></div><div class="spell-msg-inner"><span id="spell-msg-text'+this._uId+'"></span></div><div class="spell-msg-inner" id="spell-msg-close-box'+this._uId+'"><button id="spell-msg-close'+this._uId+'">OK</button></div>';l.body.appendChild(this._msgBox)}};h.sc=k})(window,document);
